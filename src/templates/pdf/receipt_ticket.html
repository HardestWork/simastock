<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        @page { size: 80mm auto; margin: 5mm; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: "Courier New", monospace; font-size: 9pt; color: #000; width: 70mm; }
        .header { text-align: center; margin-bottom: 8px; }
        .header h1 { font-size: 13pt; margin-bottom: 2px; }
        .header p { font-size: 8pt; }
        .divider { border-top: 1px dashed #000; margin: 6px 0; }
        .bold { font-weight: bold; }
        table { width: 100%; border-collapse: collapse; }
        td { padding: 2px 0; vertical-align: top; font-size: 9pt; }
        td.right { text-align: right; }
        td.qty { width: 30px; text-align: center; }
        .total-row td { font-weight: bold; font-size: 11pt; padding-top: 5px; }
        .footer { text-align: center; margin-top: 10px; font-size: 8pt; }
    </style>
</head>
<body>
    <div class="header">
        {% if invoice_config.logo_uri %}
        <p><img src="{{ invoice_config.logo_uri }}" alt="Logo" style="height:28px; width:auto;"></p>
        {% endif %}
        <h1>{{ invoice_config.business_name }}</h1>
        {% if store.address %}<p>{{ store.address }}</p>{% endif %}
        {% if store.phone %}<p>Tel: {{ store.phone }}</p>{% endif %}
        {% if invoice_config.tax_id %}<p>NIF: {{ invoice_config.tax_id }}</p>{% endif %}
    </div>

    <div class="divider"></div>

    <table>
        <tr>
            <td>Ticket No</td>
            <td class="right bold">{{ sale.invoice_number }}</td>
        </tr>
        <tr>
            <td>Date</td>
            <td class="right">{{ sale.created_at|date:"d/m/Y H:i" }}</td>
        </tr>
        <tr>
            <td>Vendeur</td>
            <td class="right">{{ sale.seller.get_full_name }}</td>
        </tr>
        <tr>
            <td>Caissier</td>
            <td class="right">{{ cashier_name|default:"-" }}</td>
        </tr>
        {% if sale.customer %}
        <tr>
            <td>Client</td>
            <td class="right">{{ sale.customer.full_name }}</td>
        </tr>
        {% endif %}
    </table>

    <div class="divider"></div>

    <table>
        {% for item in sale.items.all %}
        <tr>
            <td colspan="3" class="bold">{{ item.product_name }}</td>
        </tr>
        <tr>
            <td class="qty">{{ item.quantity }}x</td>
            <td>{{ item.unit_price|floatformat:0 }}</td>
            <td class="right">{{ item.line_total|floatformat:0 }}</td>
        </tr>
        {% endfor %}
    </table>

    <div class="divider"></div>

    <table>
        <tr>
            <td>Sous-total</td>
            <td class="right">{{ sale.subtotal|floatformat:0 }} {{ store.effective_currency|default:"FCFA" }}</td>
        </tr>
        {% if sale.discount_amount > 0 %}
        <tr>
            <td>
                {% if sale.discount_percent > 0 %}
                Remise ({{ sale.discount_percent }}%)
                {% else %}
                Remise (valeur)
                {% endif %}
            </td>
            <td class="right">-{{ sale.discount_amount|floatformat:0 }} {{ store.effective_currency|default:"FCFA" }}</td>
        </tr>
        {% endif %}
        <tr class="total-row">
            <td>TOTAL</td>
            <td class="right">{{ sale.total|floatformat:0 }} {{ store.effective_currency|default:"FCFA" }}</td>
        </tr>
    </table>

    <div class="divider"></div>

    <table>
        {% for payment in payments %}
        <tr>
            <td>{{ payment.get_method_display }}</td>
            <td class="right">{{ payment.amount|floatformat:0 }} {{ store.effective_currency|default:"FCFA" }}</td>
        </tr>
        {% endfor %}
        {% if change > 0 %}
        <tr class="bold">
            <td>Monnaie rendue</td>
            <td class="right">{{ change|floatformat:0 }} {{ store.effective_currency|default:"FCFA" }}</td>
        </tr>
        {% endif %}
    </table>

    <div class="divider"></div>

    <div class="footer">
        {% if invoice_config.footer %}
        <p>{{ invoice_config.footer }}</p>
        {% else %}
        <p>Merci pour votre achat</p>
        <p>{{ invoice_config.business_name }}</p>
        {% endif %}
        <p>{{ now|date:"d/m/Y H:i" }}</p>
    </div>
</body>
</html>
